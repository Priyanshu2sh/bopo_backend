{% extends "bopo_admin/base.html" %}
{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static 'bopo_admin/css/payment_details.css' %}">

<h2>Payment Details</h2>


<!-- Search & Filter Section -->
<div class="search-container">
    <input type="text" id="searchInput" 
           placeholder="Search by MID, Contact Person, Mobile Number, Paid Amount, Top-Up, Date, Payment Method" 
           onkeyup="filterTable()">
</div>

<!-- Merchant Table -->
<div class="table-container">
    <table class="merchant-table" id="merchantTable">
        <thead>
            <tr>
                <th>MID</th>
                <th>Project Name</th>
                <th>Contact Person</th>
                <th>Mobile Number</th>
                <th>Paid Amount</th>
                <th>Top-Up</th>
                <th>Date</th>
                <th>Payment Method</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Static Data Example -->
            <tr>
                <td>1002</td>
                <td>McDonalds</td>
                <td>Jane Smith</td>
                <td>9876543211</td>
                <td>$750</td>
                <td>$1200</td>
                <td>2025-03-19</td>
                <td>Credit Card</td>
                <td>
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </td>
            </tr>
            <tr>
                <td>1003</td>
                <td>Starbucks</td>
                <td>Shruti Desai</td>
                <td>9999999999</td>
                <td>$850</td>
                <td>$1900</td>
                <td>2025-08-21</td>
                <td>UPI</td>
                <td>
                    <button class="edit-btn">Edit</button>
                    <button class="delete-btn">Delete</button>
                </td>
            </tr>

            <!-- Dynamic Data from Django -->
            {% for merchant in merchants %}
            <tr>
                <td>{{ merchant.mid }}</td>
                <td>{{ merchant.contact_person }}</td>
                <td>{{ merchant.mobile_number }}</td>
                <td>${{ merchant.paid_amount }}</td>
                <td>${{ merchant.top_up }}</td>
                <td>{{ merchant.date }}</td>
                <td>{{ merchant.payment_method }}</td>
                <td>
                    <a href="{% url 'edit_merchant' merchant.id %}" class="edit-btn">Edit</a>
                    <a href="{% url 'delete_merchant' merchant.id %}" class="delete-btn" onclick="return confirm('Are you sure you want to delete this merchant?');">Delete</a>
                </td>
            </tr>
            {% empty %}
            {% comment %} <tr>
                <td colspan="8" class="no-data">No merchants found.</td>
            </tr> {% endcomment %}
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function filterTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("merchantTable");
        let rows = table.getElementsByTagName("tr");
        let foundAny = false;
    
        // Remove existing "No merchants found" row if it exists
        let noDataRow = document.getElementById("noDataRow");
        if (noDataRow) {
            noDataRow.remove();
        }
    
        // Loop through table rows and check for matches
        for (let i = 1; i < rows.length; i++) { 
            let cells = rows[i].getElementsByTagName("td");
            
            // If the row contains actual data (not a placeholder)
            if (cells.length > 1) {
                let found = false;
    
                // Check if any cell (except action column) contains the search input
                for (let j = 0; j < cells.length - 1; j++) { 
                    if (cells[j].innerText.toLowerCase().includes(input)) {
                        found = true;
                        break;
                    }
                }
    
                rows[i].style.display = found ? "" : "none";
                if (found) foundAny = true;
            }
        }
    
        // Insert "No merchants found" row only if no matches are found
        if (!foundAny) {
            let newRow = table.insertRow();
            newRow.id = "noDataRow";
            let cell = newRow.insertCell(0);
            cell.colSpan = 8;
            cell.classList.add("no-data");
            cell.innerText = "No merchants found.";
        }
    }
    
</script>

{% endblock %}
