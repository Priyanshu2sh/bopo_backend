{% extends "bopo_admin/base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'bopo_admin/css/customer.css' %}">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 <!-- jQuery (required for Select2) -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

 <!-- Select2 CSS & JS -->
 <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
 <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="customer-container">
    <div class="customer-header">
        <h2>Customer List</h2>
        <div class="customer-buttons">
            <button class="add-customer-btn" onclick="window.location.href='{% url 'add_customer' %}'">
                + Add Customer
            <button class="send-customer-btn" onclick="window.location.href='{% url 'send_customer_notifications' %}'">
                + Send Notifications
            </button>
        </div>
    </div>

    <div class="customer-list">
        <div class="customer-table">
            <input type="text" class="search-box" id="search-corporate" onkeyup="filterTable('corporate-table', 'search-corporate')" placeholder="Search corporate customers...">
            <table id="corporate-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Customer ID</th>
                        <th>Contact Person</th>
                        <th>Mobile Number</th>
                        <th>City</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ customer.customer_id }}</td>
                        <td>{{ customer.first_name }} {{ customer.last_name }}</td>
                        <td>{{ customer.mobile }}</td>
                        <td>{{ customer.city }}</td>
                        <td><label class="switch"><input type="checkbox" {% if customer.status == "Active" %}checked{% endif %} data-id="{{ customer.id }}" class="customer-status-toggle"><span class="slider round"></span></label></td>
                      <td>
                        <button onclick="editCustomer(
                            '{{ customer.id }}',
                            '{{ customer.first_name }}',
                            '{{ customer.last_name }}',
                            '{{ customer.email }}',
                            '{{ customer.mobile }}',
                            '{{ customer.age }}',
                            '{{ customer.gender }}',
                            '{{ customer.aadhaar_number }}',
                            '{{ customer.pan_number }}',
                            '{{ customer.city }}',
                            '{{ customer.pincode }}',
                            `{{ customer.address|escapejs }}`,
                            '{{ customer.state }}'
                        )" class="btn btn-sm btn-warning">✏️ Edit</button>
                      </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>







<!-- JavaScript for Modal and Dynamic City Dropdown -->
<script>
        function openModal() {
            document.getElementById("customerModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("customerModal").style.display = "none";
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            let modal = document.getElementById("customerModal");
            if (event.target == modal) {
                closeModal();
            }
        };
</script>



<!-- JavaScript for Search Filtering and Modal -->
<script>
    function filterTable(tableId, searchBoxId) {
        let input = document.getElementById(searchBoxId);
        let filter = input.value.toLowerCase();
        let table = document.getElementById(tableId);
        let rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {
            let rowText = rows[i].innerText.toLowerCase();
            if (rowText.includes(filter)) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    }
</script>







<!-- Confirmation Modal -->
<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <p>Are you sure you want to delete this customer?</p>
        <div class="modal-actions">
            <button type="button" onclick="confirmDelete()" class="btn btn-confirm">Yes, Delete</button>
            <button onclick="cancelDelete()" class="btn btn-cancel">Cancel</button>
        </div>
    </div>
</div>

<script>
    
    

//delete
let selectedCustomerId = null;

    function deleteCustomer(customerId) {
        selectedCustomerId = customerId;
        document.getElementById("confirmModal").style.display = "block";
    }

    function confirmDelete() {
        if (selectedCustomerId) {
            // Redirect to delete URL or make AJAX call
            window.location.href = `/bopo_admin/delete-customer/${selectedCustomerId}/`;
        }
    }

    function cancelDelete() {
        selectedCustomerId = null;
        document.getElementById("confirmModal").style.display = "none";
    }

    // Close confirm modal if clicked outside
    window.onclick = function(event) {
        const confirmModal = document.getElementById("confirmModal");
        if (event.target === confirmModal) {
            cancelDelete();
        }
    };

function showToast(message, type) {
    let toast;
    if (type === "success") {
        toast = document.getElementById("toast-success");
        toast.querySelector('.toast-message').textContent = message;
    } else {
        toast = document.getElementById("toast-info");
        toast.querySelector('.toast-message').textContent = message;
    }

    toast.classList.add("toast-show");

    setTimeout(() => {
        toast.classList.add("toast-hide");
        setTimeout(() => {
            toast.classList.remove("toast-show", "toast-hide");
        }, 500);
    }, 3000);
}


    
</script>






{% endblock %}