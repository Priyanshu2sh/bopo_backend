{% extends "bopo_admin/base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'bopo_admin/css/send_notification_customer.css' %}">

<div class="send-notification-container">
    <div class="send-notification-header">
        <h2>Send Notifications</h2>
    </div>

    <!-- Messages Display -->
    {% comment %} {% if messages %}
        <div class="message-container">
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %} {% endcomment %}

    <div class="send-notification-list">
        <!-- To Single Customers -->
        <div class="send-notification-item">
            <input type="checkbox" id="toggle-single-customer" class="toggle-checkbox">
            <label for="toggle-single-customer" class="send-notification-label">
                <span class="send-notification-icon">üë§</span>
                <span>To Single Customer</span>
            </label>

            <div class="send-notification-form">
                <br>
                <form method="POST" action="{% url 'create_notification' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="select-customer">Select Customer:</label>
                        <select id="select-customer" name="customer_id" class="form-control">
                            <option value="">-- Select Customer --</option>
                            {% for customer in customers %}
                                <option value="{{ customer.customer_id }}">
                                    {{ customer.customer_id }} - {{ customer.first_name }} {{ customer.last_name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notification-type-single">Notification Type:</label>
                        <input type="text" id="notification-type-single" name="notification_type" class="form-control" placeholder="Enter notification type">
                    </div>

                    <div class="form-group">
                        <label for="notification-title-single">Title:</label>
                        <input type="text" id="notification-title-single" name="notification_title" class="form-control" placeholder="Enter title">
                    </div>

                    <div class="form-group">
                        <label for="notification-description-single">Description:</label>
                        <textarea id="notification-description-single" name="description" class="form-control" rows="4" placeholder="Enter description"></textarea>
                    </div>

                    <div class="button-container">
                        <button class="send-btn" type="submit">
                            <i class="fa fa-paper-plane"></i> Send
                        </button>
                        <button class="cancel-btn" type="reset">
                            <i class="fa fa-times-circle"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- To All Customers -->
        <form method="POST" action="{% url 'create_notification' %}">
            {% csrf_token %}
            <div class="send-notification-item">
                <input type="checkbox" id="toggle-all-customers" class="toggle-checkbox" name="to_all_customer" value="true">
                <label for="toggle-all-customers" class="send-notification-label">
                    <span class="send-notification-icon">üè¢</span>
                    <span>To All Customers</span>
                </label>

                <div class="send-notification-form"><br>
                    <div class="form-group">
                        <label for="notification-type-all">Notification Type:</label>
                        <input type="text" id="notification-type-all" class="form-control" placeholder="Enter notification type" name="notification_type">
                    </div>

                    <div class="form-group">
                        <label for="notification-title-all">Title:</label>
                        <input type="text" id="notification-title-all" class="form-control" placeholder="Enter title" name="notification_title">
                    </div>

                    <div class="form-group">
                        <label for="notification-description-all">Description:</label>
                        <textarea id="notification-description-all" class="form-control" rows="4" placeholder="Enter description" name="description"></textarea>
                    </div>

                    <div class="button-container">
                        <button class="send-btn" type="submit">
                            <i class="fa fa-paper-plane"></i> Send
                        </button>
                        <button class="cancel-btn" type="reset">
                            <i class="fa fa-times-circle"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>


{% if messages %}
<div id="toast" class="toast-container toast-show">
    {% for message in messages %}
        <i class="fa fa-exclamation-circle"></i>
        <span class="toast-message">{{ message }}</span>
    {% endfor %}
</div>
{% endif %}


<!-- Toggle JS -->
<script>

document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        const toast = document.querySelector('.toast-container');
        if (toast) toast.remove();
    }, 4000);
});


    document.addEventListener("DOMContentLoaded", function () {
        const toggleCheckboxes = document.querySelectorAll(".toggle-checkbox");

        toggleCheckboxes.forEach((checkbox) => {
            checkbox.addEventListener("change", function () {
                const form = this.closest(".send-notification-item").querySelector(".send-notification-form");

                // Close other forms
                document.querySelectorAll(".send-notification-form").forEach((otherForm) => {
                    if (otherForm !== form) {
                        otherForm.style.display = "none";
                        otherForm.closest(".send-notification-item").querySelector(".toggle-checkbox").checked = false;
                    }
                });

                // Show selected form
                form.style.display = this.checked ? "block" : "none";
            });
        });

        // Hide all forms initially
        document.querySelectorAll(".send-notification-form").forEach((form) => {
            form.style.display = "none";
        });
    });
</script>

{% endblock %}
